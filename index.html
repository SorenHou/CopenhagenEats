<!DOCTYPE html>
<html>
  <head>
    <title>Copenhagen Eats</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald&display=swap" />
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">

<style>
  /* Add the font-family property to your header and pane */
  header,
  #locations-pane {
    font-family: 'Oswald', sans-serif;
    box-sizing: border-box; /* Include padding and border within the element's dimensions */
  }

  #map {
    width: 80%;
    height: 100%;
  }
  html,
  body {
    height: 100%;
    margin: 0;
    padding: 0;
    background-color: #f1f1f1;
  }
  header {
    text-align: center;
    padding: 20px 5px 5px;
    background-color: #f1f1f1;
    height: 20%; /* Adjust the header height */
  }
  /* Add any other CSS properties you want for your pane */
  #locations-pane {
    font-size: 16px;
  }

  .main-container {
    display: flex;
    height: 80%; /* Set the height of the main container */
  }

  #map {
    width: 80%;
    height: 100%;
  }

  #locations-pane {
    width: 20%;
    height: 100%;
    overflow-y: auto;
    padding: 10px;
  }
  
  /* Increase the font size of the header text and reduce line-height */

  header h1 {
    font-size: 4vw; /* Use viewport width units (vw) for dynamic scaling */
    line-height: 1;
    margin-top: 0;
  }

  /* Larger font size for larger screens */
  @media (min-width: 768px) {
    header h1 {
      font-size: 64px; /* Set a fixed font size for screens wider than 768px */
    }
  }

  
  header p {
    font-size: 18px;
    line-height: 1.2; /* Adjust the line-height for the description text */
    margin-top: 5px 0; /* Remove space above the header p */
  }
  
  .filter-container {
  display: flex;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

.filter-item {
  width: 100%;
  display: flex;
  align-items: center;
  margin-bottom: 5px;
}

.filter-item input[type="checkbox"] {
  margin-right: 5px;
}

.filter-item img {
  width: 24px; /* Adjust this value to change the icon size */
  height: 24px; /* Adjust this value to change the icon size */
  margin-right: 5px;
}

@media (min-width: 768px) {
  .filter-item {
    width: 33%;
  }
}

  
</style>

  </head>
  <body>
    <header>
  <h1>Copenhagen Eats</h1>
  <p>Discover great places to eat in Copenhagen</p>
</header>

<div class="main-container">
  <div id="map"></div>
  <div id="locations-pane">
    <div class="filter-container">
      <div class="filter-item">
        <input type="checkbox" id="price-0-300" checked />
        <label for="price-0-300">
          <img src="https://raw.githubusercontent.com/SorenHou/CopenhagenEats/main/YellowIcon.png" alt="0-300 DKK" />
          0-300 DKK
        </label>
      </div>
      <div class="filter-item">
        <input type="checkbox" id="price-300-600" checked />
        <label for="price-300-600">
          <img src="https://raw.githubusercontent.com/SorenHou/CopenhagenEats/main/BlueIcon.png" alt="300-600 DKK" />
          300-600 DKK
        </label>
      </div>
      <div class="filter-item">
        <input type="checkbox" id="price-600-plus" checked />
        <label for="price-600-plus">
          <img src="https://raw.githubusercontent.com/SorenHou/CopenhagenEats/main/RedIcon.png" alt="600+ DKK" />
          600+ DKK
        </label>
      </div>
    </div>
  </div>
</div>

<script>
  const allLocations = [];
  const allMarkers = [];
  const allInfoWindows = [];

  function filterLocations() {
  const showPrice0to300 = document.getElementById('price-0-300').checked;
  const showPrice300to600 = document.getElementById('price-300-600').checked;
  const showPrice600Plus = document.getElementById('price-600-plus').checked;

  // Iterate over all locations and markers
  for (let i = 0; i < allLocations.length; i++) {
    const location = allLocations[i];
    const marker = allMarkers[i];
    const infowindow = allInfoWindows[i];

    const iconHref = marker.getIcon().url;

    let shouldShow = false;
    if (iconHref.includes('yellow') && showPrice0to300) {
      shouldShow = true;
    } else if (iconHref.includes('blue') && showPrice300to600) {
      shouldShow = true;
    } else if (iconHref.includes('red') && showPrice600Plus) {
      shouldShow = true;
    }

    location.locationDiv.style.display = shouldShow ? 'block' : 'none';
    marker.setVisible(shouldShow);

    if (!shouldShow && infowindow.getMap() === map) {
      infowindow.close();
    }
  }
}



  async function fetchLocationDataFromKml() {
    const response = await fetch('https://raw.githubusercontent.com/SorenHou/CopenhagenEats/main/MapFile.kml');
    const data = await response.text();
    const parser = new DOMParser();
    const kml = parser.parseFromString(data, 'application/xml');

    const folders = kml.querySelectorAll('Folder');
    console.log('Folders:', folders.length);
    folders.forEach((folder, folderIndex) => {
      const placemarks = folder.querySelectorAll('Placemark');
      console.log(`Folder ${folderIndex + 1} Placemarks:`, placemarks.length);
      placemarks.forEach((placemark) => {
        const nameElement = placemark.querySelector('name');
        const descriptionElement = placemark.querySelector('description');
        const coordinatesElement = placemark.querySelector('coordinates');
        const styleUrlElement = placemark.querySelector('styleUrl');

        if (nameElement && coordinatesElement && styleUrlElement) {
          const name = nameElement.textContent;
          const description = descriptionElement ? descriptionElement.textContent : '';
          const coordinatesText = coordinatesElement.textContent;
          const coordinatesArray = coordinatesText.split(',').map(parseFloat);
          const locationCoords = {
            lat: coordinatesArray[1],
            lng: coordinatesArray[0],
          };

          const styleUrl = styleUrlElement.textContent;
          const iconStyle = kml.querySelector(`Style[id="${styleUrl.slice(1)}"]`);
          const iconHrefElement = iconStyle.querySelector('href');
          const iconHref = iconHrefElement ? iconHrefElement.textContent : '';

          const locationDiv = document.createElement('div');
          locationDiv.classList.add('location');
          locationDiv.style.display = 'block';


          const locationName = document.createElement('h3');
          locationName.textContent = name;
          locationDiv.appendChild(locationName);

          const locationDescription = document.createElement('p');
          locationDescription.textContent = description;
          locationDiv.appendChild(locationDescription);

          locationDiv.addEventListener('click', () => {
          map.setCenter(locationCoords);
          map.setZoom(16);
          if (currentInfoWindow) {
            currentInfoWindow.close();
          }
          infowindow.open(map, marker);
          currentInfoWindow = infowindow;
        });


          const locationsPane = document.getElementById('locations-pane');
          locationsPane.appendChild(locationDiv);

          const iconSize = new google.maps.Size(32, 32); // Adjust these values to change the icon size
          const marker = new google.maps.Marker({
                    position: locationCoords,
          map: map,
          title: name,
          icon: {
            url: iconHref,
            scaledSize: iconSize,
          },
        });

        const infowindow = new google.maps.InfoWindow({
          content: `<h3>${name}</h3><p>${description}</p>`,
        });

        marker.addListener('click', () => {
          if (currentInfoWindow) {
            currentInfoWindow.close();
  }
  infowindow.open(map, marker);
  currentInfoWindow = infowindow;
});

        allLocations.push({ locationDiv, styleUrl });
        allMarkers.push(marker);
        allInfoWindows.push(infowindow);

      }
    });
  });
  // Add event listeners for checkboxes
  document.getElementById('price-0-300').addEventListener('change', filterLocations);
  document.getElementById('price-300-600').addEventListener('change', filterLocations);
  document.getElementById('price-600-plus').addEventListener('change', filterLocations);

}
/*
        // Add event listeners for checkboxes
        document.getElementById('price-0-300').addEventListener('change', filterLocations);
        document.getElementById('price-300-600').addEventListener('change', filterLocations);
        document.getElementById('price-600-plus').addEventListener('change', filterLocations);

*/

let map;
let currentInfoWindow = null; // Add this line


function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: { lat: 55.6761, lng: 12.5683 }, // Center the map on Copenhagen
  });

  fetchLocationDataFromKml();
}

function loadGoogleMapsApi() {
  const script = document.createElement('script');
  script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyDTV1aLFYT4vIK6FhFJnqRflsrtRGpbd1I&callback=initMap';
  script.async = true;
  script.defer = true;
  document.body.appendChild(script);
}

window.addEventListener('DOMContentLoaded', loadGoogleMapsApi);
</script>

      </body>
</html>
